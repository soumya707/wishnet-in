{% extends "self_care_layout.html" %}

{% block title %}Self-care add plan{% endblock %}

{% block portal_content %}

<div class="col-sm-8 p-3">

  <h3 class="py-2 text-red">Add Plan</h3>

  <form method="POST" id="payment-form">
    <!-- CSRF token -->
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <!-- Selected plan code -->
    <input type="hidden" name="amount" value="" id="selected-plan-code">
    <!-- Transaction amount -->
    <input type="hidden" name="plan_code" value="" id="total-price">

    <!-- AVAILABLE PLAN TABLE -->
    {% if not available_plans %}
    <h5 class="py-4 text-red">You don't have any available plans.</h5>
    {% elif available_plans %}
    <table class="table table-striped table-bordered table-responsive">
      <thead>
        <tr>
          <th scope="col"></th>
          <th scope="col">Plan Name</th>
          <th scope="col">Price</th>
          <th scope="col">Speed (in Mbps)</th>
          <th scope="col">Validity (in days)</th>
          <th scope="col">Plan Type</th>
        </tr>
      </thead>
      <tbody>
        {% for name, (price, code, speed, validity, type) in available_plans.items() %}
        <tr scope="row">
          <td>
            <input type="radio"
                   name="plan" value="{{ price ~ '-' ~ code }}" id="{{ name }}"
                   autocomplete="off" onchange="fillForm(this);"
                   {% if loop.first %}checked{% endif %}>
          </td>
          <td>{{ name }}</td>
          <td>&#8377 {{ price }}</td>
          <td>{{ speed }}</td>
          <td>{{ validity }}</td>
          <td>{{ type }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}

  </form>

</div> <!-- col -->

{% endblock %}

{% block script %}

{{ super() }}

<script>

  $(document).ready(function() {
      fillForm('input[name=plan-type]:checked');
  });

  function fillForm(elem) {
      // add GST to selected plan and set total price
      var arr = $(elem).val().split("-");
      var price = arr[0];
      var code = arr[1];
      var totalPrice = (parseFloat(price) * 1.18).toFixed(2).toString();
      // fill hidden fields for selected plan code and price
      $("#selected-plan-code").val(code);
      $("#total-price".val(totalPrice));
  }

</script>

{% endblock %}
